# KCSAT 스프링 커뮤니티 서버

## 사용 기술 스택
1. Spring Boot 3.3.4
2. PostgreSQL (메인 데이터 저장 용도)
    - Spring Data JPA (메인 DB 송수신)
    - QueryDSL (게시판 페이지 검색 쿼리문 작성)
3. Redis (조회수, 추천수, 캐싱용)
4. Spring Security
5. JWT

## 기술 이용
1. 대부분의 데이터는 PostgreSQL을 사용하여 저장하도록 하였음.
2. 기본적으로 JPA를 사용하여 DB 송수신을 처리함.
3. JPA로 처리하기 어려운 쿼리문 같은 경우, QueryDSL을 사용하여 직접 SQL 형태로 설계하였음.
4. 로그인 구현을 위해 Spring Security를 사용하였고, Only 세션 대신 JWT 토큰을 사용하여 사용자 정보를 저장하여 프론트엔드에서도 쉽게 사용자 정보 출력 로직을 구현하도록 함.
5. Spring Security를 사용하여 Priority를 Admin, User 계층으로 나누었음.
   - 향후 VIP 계층을 추가하여 유료 회원의 경우, Kafka AI 서버에서 생성 우선순위를 부여하는 방식도 생각 중.

## 기술 도입에 대한 생각
1. 조회수, 추천수 또는 캐싱과 같은 디스크 I/O 요청이 잦지만, 데이터 정합성 보장 중요도가 상대적으로 떨어지는 데이터는 Redis In-Memory DB에 저장하도록 하여 지연시간을 줄였음.
2. Redis에 조회 여부를 기록해두고, 매일 0시에 자동으로 SCAN 1000개 하고 100개씩 순차적으로 배치 처리로 삭제하도록 하여 순간 부하 방지. 아주 많은 유저가 있는 경우, Redis 인스턴스 갯수를 늘려 병렬 처리하는 방안도 생각해볼 수 있음.
3. 게시글 상세 정보를 조회할 때, 댓글도 같이 표시되기 때문에 '게시글 쿼리 -> 댓글 쿼리' N+1 문제가 발생한다. Fetch Join을 적용하여 게시글 가져올 때 댓글도 함께 가져오도록 해결.
4. 댓글 삭제할 때 회원 정보 조회하는 경우에도 위와 마찬가지로 Fetch Join으로 댓글+작성 회원 정보를 동시에 가져와 N+1 문제 방지.
5. 자주 조회되는 항목의 경우, @Id 또는 @Column(unique=true)를 통한 유일성 보장으로 인덱스 생성을 통해 성능 향상.
6. JWT를 Spring 안에서 세션 형태가 아닌 Redis에 상태를 저장하는 형식으로 보관하는 경우, 실시간 수평 확장과 로드 밸런싱 과정으로 매 요청마다 서로 다른 레플리카 Spring 서버에 요청되어도 정상적으로 상태에 대해 응답할 수 있도록 설계가 가능할 것으로 예상.
7. stream 과정을 통한 객체 변환/연산 과정에서 무상태성을 보장하는 연산이라도, parallelStream 병렬 연산을 도입하지 않았음. n < 100의 작은 데이터 연산에는 여러 연산으로 분리하는 오버헤드가 크다고 판단하였음.

## 핵심 구현 기능
1. 자유 게시판
    - 사용자들이 자유롭게 글을 작성하여 게시할 수 있음.
    - 글을 작성할 때, 마이 워크북에 있는 문제를 첨부하는 것이 가능함.
    - 작성한 글에 첨부된 문제를 다른 사용자들이 워크북에 퍼갈 수 있음.
    - 사용자들이 댓글을 달 수 있고, 게시글과 댓글에 작성자 이외의 사람들이 추천/비추천 할 수 있음.
2. HOT 게시판
    - 기본적인 기능은 자유 게시판과 동일.
    - 자유 게시판에서 추천수 20 이상인 경우, HOT 게시판에도 동시에 등록 됨.
3. 마이 워크북
    - AI 문제 생성 서버에서 만들어진 문제를 각 사용자 별로 저장 가능. (포맷 : { 문제, 본문, 보기, 해석, 해설 })
    - 저장한 문제들을 이 곳에서 확인할 수 있음.
4. 이 주의 문제
    - 매주 월요일 자정에 이 주의 문제를 선별하여 등재함.
    - Reddit Ranking Algorithm 에 따라 랭킹을 매겨 선별. (log10(추천 수) + 작성 시간 내림차순)
5. Admin 페이지
    - Admin 계정의 경우에만 접근 가능.
    - 가입 사용자 목록, 작성 게시글, 댓글, 건의사항 조회.